---
layout: default
title: Introduction
output: bookdown::html_chapter
---

# 들어가며 {#intro-why}

R에서 공유 코드의 기본 단위가 팩키지(package)다. 
패키지(Package)는 코드, 데이터, 문서, 테스트를 묶어 포함하고 있으며, 다른 사람과 공유하기 쉽다.
2015년 1월 기준, R 팩키지를 위한 공공정보센터인 CRAN (**C**omprehensive **R** **A**rchive **N**etwork)에 6,000 개가 넘는 팩키지가 있다. 다양하고 엄청난 팩키지 숫자가 R이 성공한 요인 중 하나다: 누군가 여러분이 작업하고 있는 문제를 이미 해결했고, 따라서 해답이 담겨있는 팩키지를 다운로드 함으로써 작업에 혜택을 받을 수 있어서일 것이다.


만약 이 책을 읽고 있다면, 이미 팩키지 사용법을 알고 있다:

* `install.packages("x")` 명령어로 CRAN에서 팩키지를 설치한다.
* `library("x")` 명령어로 R에서 사용한다.
* `package?x` 와 `help(package = "x")` 명령어로 도움말을 얻는다.

이 책의 목적은 팩키지 개발하는 방법을 가르치는 것이다. 따라서 다른 사람이 작성한 팩키지를 사용하지만 말고 본인 스스로 팩키지를 작성할 수 있다.
그럼 왜 팩키지를 작성할까? 한가지 설득력있는 이유는 다른 사람과 공유하고 싶은 코드를 만들었기 때문이다.
코드를 팩키지에 넣어 번들링(bundling)하게 되면 다른 사람도 사용하기가 쉽다. 왜냐하면, 여러분처럼 다른 사람도 이미 팩키지 사용법을 알고 있기 때문이다.
만약 코드가 팩키지에 담겨있다면, 어떤 R 사용자도 쉽게 다운로드받아, 설치하고, 사용법을 배울 수 있다.

하지만, 코드를 공유하지 않을 때 조차도 팩키지는 유용하다.
Hilary Parker가 [팩키지 소개(introduction to packages)](http://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/) 언급했듯이 "심각하게 생각하면 (설사 부가적 혜택이 있을지라도) 코드를 공유에 관한 것이 될 필요는 없고, 여러분의 시간을 절약하는 것에 관한 것이다."
팩키지로 코드를 조직화해서 관리하면 삶이 더 쉬워진다. 왜냐하면 팩키지가 관례(convention)와 함께 오기 때문이다. 예를 들어, R 코드를 `R/` 디렉토리에 넣고, 테스트를 `tests/` 디렉토리에, 데이터를  `data/` 디렉토리에 넣는다.
이러한 관례가 도움이 된다. 왜냐하면:

* 여러분의 시간을 절약해주기 때문이다 --- 프로젝트를 조직화하고 구조화하는 가장 최선의 방법을 찾는 생각을 할 필요가 없고, 단지 템플릿(template)만 쫓아가면 된다.

* 표준화된 관례는 표준화된 도구로 이끈다 (Standardised conventions lead to standardised tools) --- 만약 R 팩키지 관례를 도입하기로 결정하면, 무료로 많은 도구가 생긴다. 

팩키지를 사용해서 데이터 분석업무를 구조화하는 것도 가능하다. 이 방법에 대한 자세한 내용은 Robert M Flight의 [블로그 포스트](http://rmflight.github.io/posts/2014/07/analyses_as_packages.html)를 참조한다.

## 철학 {#intro-phil}

이 책에는 팩키지 개발에 대한 Hadley Wickham 철학이 담겨있다: 자동화될 수 있는 것은 자동화 되어야 한다(anything that can be automated, should be automated). 수작업은 가능하면 적게한다. 함수(function)로 가능하면 많은 작업을 한다. 팩키지 구조의 자세한 사항에 대해 많이 생각하기보다는 작성한 팩키지가 수행할 수 있는 것에 관한 생각에 더 많은 시간을 사용하는 것이 목표다. 

이 철학은 주로 Hadley Wickham이 일반 개발작업 자동화 목적으로 작성한 `devtools` 팩키지를 통해서 구현된다. `devtools` 개발목표는 팩키지 개발과정을 가능하면 덜 고통스럽게 만드는 것이다. 수년동안 Hadley Wickham이 배운 팩키지 개발과정의 모든 모범사례(best practice)를 캡슐화해서 가능하게 했다. `devtools`를 통해서 수많은 잠재적 실수로부터 여러분을 지켜준다. 그렇게 함으로써 팩키지 개발보다는 관심가지고 풀고자하는 문제에 집중하게 한다. 

`devtools`는 RStudio와 손에 손잡고 함께 가는데, Hadley Wickham 생각과 번역자도 동의하는 부분이지만, 대부분의 R 사용자에게 가장 최상의 개발환경을 제공한다. 거의 유일한 경쟁자는 [ESS(emacs speaks statistics)](http://ess.r-project.org/)로 만약 이맥스를 학습하고 필요에 맞출 수 있다면 상응하는 노력에 대한 보상을 줄 수 있는 개발환경이다. 이맥스의 역사(R보다도 오래됨)는 20년 이상 거슬러 올라간다. 하지만, 여전히 활발하게 개발이 진행되고 있고, 이 책에 기술된 많은 워크플로우는 이맥스에도 적용된다.

`devtools`와 `RStudio`가 팩키지 개발 방법에 대한 저수준 상세함으로부터 여러분을 격리시켜 준다.
좀더 많은 팩키지를 개발할 때, 저수준 상세함에 관심을 가지고 더 학습하길 강력히 추천한다.
팩키지 개발을 위한 공신력 있는 상세 정보에 대한 최고 출처는 [R 확장자 작성(writing R extensions)][r-ext] 매뉴얼이다. 하지만, 만약 팩키지 기본에 아직 친숙하지 않다면, 이해하기 어려운 것이 이 매뉴얼이기도 하다. 또한, 이 책에서처럼 가장 많이 사용하고 유용한 구성요소에 집중하기 보다, 모든 가능한 팩키지 구성요소를 철저히 다루고 있다. 기초를 충분히 익히고, 내부 동작원리를 알고자 하면 [R 확장자 작성(writing R extensions)][r-ext] 매뉴얼이 유용한 정보원천이 된다.  

## 이 책에 대해서 {#intro-outline}

[R packages](#package-structure)에서 기본 팩키지 구조와 형태에 대해 학습을 시작한다. 그리고 나서, 다음 책 10장은 각 구성요소에 대한 상세부분으로 들어간다. 대략 중요도에 따라 다음과 같이 구성된다.


* [R code](#r): 가장 중요한 디렉토리는 `R/`이고, 여기에 R 코드가 살아 있다.
단지 이 디렉토리만 갖는 팩키지도 여전히 유용한 팩키지다. (사실, 만약 이 장만 읽고 책읽기를 멈춘다고 하더라도, 여전히 앞으로도 유용한 신규기술을 배울 필요가 있다.)
  
* [Package metadata](#description): `DESCRIPTION`에는 작성한 팩키지가 무슨 작업을 수행하는지 기술한다. 
  만약 팩키지를 공유하려고 한다면, `DESCRIPTION`을 사용해서 팩키지가 무엇을 수행하고, 누가 사용권한(license)을 갖는지,
  그리고 만약 뭔가 잘못 동작하면 누구에게 연락해야 하는지 기술한다.

* [Documentation](#man): if you want other people (including future-you!) to
  understand how to use the functions in your package, you'll need to document
  them. I'll show you how to use roxygen2 to document your functions. I 
  recommend roxygen2 because it lets you write code and documentation together
  while continuing to produce R's standard documentation format.
  
* [Vignettes](#vignettes): function documentation describes the nit-picky
  details of every function in your package. Vignettes give the big picture.
  They're long-form documents that show how to combine multiple parts of your 
  package to solve real problems. I'll show you how to use Rmarkdown and knitr
  to create vignettes with a minimum of fuss.

* [Tests](#tests): to ensure your package works as designed (and continues to
  work as you make changes), it's essential to write unit tests which define
  correct behaviour, and alert you when functions break. In this chapter, I'll
  teach you how to use the testthat package to convert the informal
  interactive tests that you're already doing to formal, automated tests.

* [Namespace](#namespace): to play nicely with others, your package needs
  to define what functions it makes available to other packages and what 
  functions it requires from other packages. This is the job of the `NAMESPACE`
  file and I'll show you how to use roxygen2 to generate it for you. 
  The `NAMESPACE` is one of the more challenging parts of developing an R 
  package but it's critical to master if you want your package to work reliably.
 
* [External data](#data): the `data/` directory allows you to include 
  data with your package. You might do this to bundle data
  in a way that's easy for R users to access, or just to provide compelling 
  examples in your documentation.

* [Compiled code](#src): R code is designed for human efficiency, not computer
  efficiency, so it's useful to have a tool in your back pocket that allows you
  to write fast code. The `src/` directory allows you to include speedy 
  compiled C and C++ code to solve performance bottlenecks in your package.

* [Other components](#misc): this chapter documents the handful of other 
  components that are rarely needed: `demo/`, `exec/`, `po/` and `tools/`.

The final three chapters describe general best practices not specifically tied to one directory:

* [Git and github](#git): mastering a version control system is vital to easily
  collaborate with others, and is useful even for solo work because it allows 
  you to easily undo mistakes. In this chapter, you'll learn how to use the 
  popular git and GitHub combo with RStudio.
  
* [Automated checking](#check): R provides very useful automated quality checks
  in the form of `R CMD check`. Running them regularly is a great way to avoid
  many common mistakes. The results can sometimes be a bit cryptic, so I 
  provide a comprehensive cheatsheet to help you convert warnings to
  actionable insight.
  
* [Release](#release): the life-cycle of a package culminates with release
  to the public. This chapter compares the two main options (CRAN and github)
  and offers general advice on managing the process.

This is a lot to learn, but don't feel overwhelmed. Start with a minimal subset of useful features (e.g. just an `R/` directory!) and build up over time. To paraphrase the Zen monk Shunryu Suzuki: "Each package is perfect the way it is --- and it can use a little improvement".

## Getting started {#intro-get}

To get started, make sure you have the latest version of R (at least `r paste0(version$major, ".", version$minor)`, which is the version that the code in this book uses), then run the following code to get the packages you'll need:

```{r, eval = FALSE}
install.packages(c("devtools", "roxygen2", "testthat", "knitr"))
```

Make sure you have a recent version of RStudio. You can check you have the right version by running:

```{r, eval = FALSE}
install.packages("rstudioapi")
rstudioapi::isAvailable("0.99.149")
```

If not, you may need to install the preview version from <http://www.rstudio.com/products/rstudio/download/preview/>. This gives you access to the latest and greatest features, and only slightly increases your chances of finding a bug. 

Use the following code to access new devtools functions as I develop them. This is particularly important during the development of the book.

```{r, eval = FALSE}
devtools::install_github("hadley/devtools")
```

You'll also need a C compiler and a few other command line tools. If you're on Windows or Mac and you don't already have them, RStudio will install them for you. Otherwise:

* On Windows, download and install [Rtools](http://cran.r-project.org/bin/windows/Rtools/). 
  NB: this is not an R package!

* On Mac, make sure you have either XCode (available for free in the App Store)
  or the ["Command Line Tools for Xcode"](http://developer.apple.com/downloads).
  You'll need to have a (free) Apple ID.

* On Linux, make sure you've installed not only R, but also the R development
  tools. For example, on Ubuntu (and Debian) you need to install the 
  `r-base-dev` package.

You can check that you have everything installed and working by running the following code:

```{r, eval = FALSE}
library(devtools)
has_devel()
#> '/Library/Frameworks/R.framework/Resources/bin/R' --vanilla CMD SHLIB foo.c 
#> 
#> clang -I/Library/Frameworks/R.framework/Resources/include -DNDEBUG 
#>   -I/usr/local/include -I/usr/local/include/freetype2 -I/opt/X11/include
#>   -fPIC  -Wall -mtune=core2 -g -O2  -c foo.c -o foo.o
#> clang -dynamiclib -Wl,-headerpad_max_install_names -undefined dynamic_lookup
#>   -single_module -multiply_defined suppress -L/usr/local/lib -o foo.so foo.o 
#>   -F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework 
#>   -Wl,CoreFoundation
[1] TRUE
```

This will print out some code which I use to help diagnose problems. If everything is ok, it will return `TRUE`. Otherwise, it will throw an error and you'll need to investigate what the problem is.

## Acknowledgments {#intro-ack}

The tools in this book wouldn't be possible without many open source contributors. [Winston Chang](https://github.com/wch/), my co-author on devtools, spent hours debugging painful S4 and compiled code problems so that devtools can quickly reload code for the vast majority of packages. [Kirill Müller](https://github.com/krlmlr) contributed great patches to many of my package development packages including devtools, testthat, and roxygen2. [Kevin Ushey](http://github.com/kevinushey), [JJ Allaire](https://github.com/jjallaire) and [Dirk Eddelbuettel](http://dirk.eddelbuettel.com) tirelessly answered all my basic C, C++ and Rcpp questions. [Peter Danenburg](https://github.com/klutometis) and [Manuel Eugster](http://www.statistik.lmu.de/~eugster/) wrote the first version of roxygen2 during a Google Summer of Code. [Craig Citro](https://github.com/craigcitro) wrote much of the code to allow travis to work with R packages.

Often the only way I learn how to do it the right way is by doing it the wrong way first. For suffering many of package development errors, I'd like to thank all the CRAN maintainers, especially Brian Ripley, Uwe Ligges and Kurt Hornik. 

This book was [written in the open](https://github.com/hadley/r-pkgs/) and it is truly a community effort: many people read drafts, fixed typos, suggested improvements, and contributed content. Without those contributors, the book wouldn't be nearly as good as it is, and I'm deeply grateful for their help. A special thanks goes to Peter Li, who read the book from cover-to-cover and provided many fixes. I also deeply appreciate the time the reviewers ([Duncan Murdoch](http://www.stats.uwo.ca/faculty/murdoch/), [Karthik Ram](http://karthik.io), [Vitalie Spinu](http://vitalie.spinu.info) and [Ramnath Vaidyanathan](https://ramnathv.github.io)) spent reading the book and giving me thorough feedback.

```{r, results = "asis", echo = FALSE, eval = TRUE}
# git --no-pager shortlog -ns > contribs.txt
contribs <- read.delim("contribs.txt", header = FALSE, 
  stringsAsFactors = FALSE)[-1, ]
names(contribs) <- c("n", "name")

contribs <- contribs[order(contribs$name), ]
contribs$uname <- ifelse(!grepl(" ", contribs$name), 
  paste0("@", contribs$name), contribs$name)

cat("Thanks go to all contributors who submitted improvements via github (in alphabetical order): ")
cat(paste0(contribs$uname, collapse = ", "))
cat(".\n")
```

## Conventions {#intro-conventions}

Throughout this book, I write `foo()` to refer to functions, `bar` to refer to variables and function parameters, and `baz/` to paths. 

Larger code blocks intermingle input and output. Output is commented so that if you have an electronic version of the book, e.g., <http://r-pkgs.had.co.nz>, you can easily copy and paste examples into R. Output comments look like `#>` to distinguish them from regular comments.

## Colophon {#intro-colophon}

This book was written in [Rmarkdown](http://rmarkdown.rstudio.com/) inside [RStudio](http://www.rstudio.com/ide/). [knitr](http://yihui.name/knitr/) and [pandoc](http://johnmacfarlane.net/pandoc/) converted the raw Rmarkdown to html and pdf. The [website](http://r-pkgs.had.co.nz) was made with [jekyll](http://jekyllrb.com/), styled with [bootstrap](http://getbootstrap.com/), and automatically published to Amazon's [S3](http://aws.amazon.com/s3/) by [travis-ci](https://travis-ci.org/). The complete source is available from [github](https://github.com/hadley/r-pkgs).

This version of the book was built with:

```{r}
library(roxygen2)
library(testthat)
devtools::session_info()
```

[r-ext]:http://cran.r-project.org/doc/manuals/R-exts.html#Creating-R-packages
