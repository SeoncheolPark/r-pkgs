---
title: Releasing a package
layout: default
output: bookdown::html_chapter
---

# 팩키지 출시 {#release}

만약 작성한 팩키지가 R 커뮤니티에 상당한 주목을 얻고자 한다면,
CRAN에 팩키지를 제출할 필요가 있다.
CRAN에 제출하는 것은 GitHub에 개발된 팩키지를 올리는 것보다 훨씬 더 많은 작업이 필요하다.
하지만, 방대한 R 사용자는 GitHub에서 팩키지를 설치하지 않는데 이유는
CRAN이 인증 도장을 찍어주고, 설치를 쉽게 하고, 발굴성도 제공하기 때문이다.
CRAN 제출 프로세스는 당혹스러울 수 있지만, 그럴 가치가 충분히 있다.
이번 장에서는 가능하면 고통이 없도록 이 과정을 만들어 본다.

작성한 팩키지를 출시 준비하려면, 다음 단계를 따른다:

1. 버젼 번호를 고른다.
1. `R CMD check` 명령어를 실행하고 문서화한다.
1. CRAN 정책에 맞췄는지 검사한다.
1. `README.md` 와 `NEWS.md` 파일을 갱신한다.
1. CRAN에 팩키지를 제출한다.
1. 버젼 번호를 갱신해서 차기 버젼을 준비한다.
1. 신규버젼을 출시한다.


## 버젼 번호 {#release-version}

[versioning](#version)에 조언을 따른다면,
개발중인 팩키지 버젼 번호는 4개 구성요소를 갖게된다, `주번호.소번호.패치번호.개발번호(
major.minor.patch.dev)`, 여기서
`dev`는 최소 9000 이다. 번호 9000은 작위적이지만,
버젼번호와 다른 무언가 있다는 강력한 시각적 신호를 전달한다.
출시된 팩키지에는 `dev` 구성요소가 없어서, 9000 을 떼고 변경한 내역에 기반해서 버젼 번호를 선택한다.
예를 들어, 현재 버젼이 `0.8.1.9000`이면, 차기 CRAN 버젼은 `0.8.2`, `0.9.0` 혹은 `1.0.0`이 될 것인가?
다음 조언을 사용해서 결정하라:
  
  * __패치(patch)__에 대해서는 예를 들어, `0.8.2`처럼 `패치(patch)`를 증가시킨다:
    상당한 신규 기능을 추가하지 않고 버그를 수정했을 경우.
    출시후에 가능하면 빠른시간 내에 고쳐질 필요가 있는 박수갈채를 받는 버그를 발견하였다면,
    저자는 패치 출시 작업을 수행한다.
    대부분 출시는 패치 번호 0을 갖는다.
    

  * __소번호 출시(minor release)__에 대해서는 예를 들어, `0.9.0`처럼 `소번호(minor)`를 증가시킨다:
    소번호 출시는 버그 수정, 신규 기능, 이전 버젼과 호환성을 위한 변경이 포함된다.
    이것이 가장 일반적인 출시 유형이다. 엄청 많은 소번호 출시를 취하는 것은 완전히 좋다.
    두자리 (혹은 세자리) 번호도 사용할 수 있다, 예를 들어, `1.17.0`.
  
  * __대번호 출시(major release)__에 대새서는 예를 들어, `1.0.0` 처럼 `대번호(major)`를 증가시킨다:
    이전 버젼과 호환되지 않거나, 많은 사용자에게 영향을 미칠 수 있는 변경사항을 위해 최대한 유보한다.
    일반적으로 `0.b.c` 에서 `1.0.0`으로 옮겨가는 것은 
    작성한 팩키지가 안정된 API로 완벽한 기능을 갖췄음을 나타낸다.
  
    실무에서, 이전 버젼과 호화성 제공은 모 아니면 도식의 임계값이 있는 것은 아니다.
    예를 들어, 거의 사용되지 않는 코드 부분에 API와 호환되지 않는 변경을 했다면,
    대번호 변경을 받지는 못할 것 같다. 하지만, 많은 사람이 의존성을 갖는 버그를 수정했다면,
    API가 파괴되는 변화처럼 느껴질 것이다. 본인 스스로 최선의 판단을 하세요.
    
    
## 이전 버젼과 호환성 (Backward compatibility)

대번호와 소번호 버젼 간에 큰 차이는 코드가 이전 버젼과 호환이 되는지 안되느냐에 달려있다.
이러한 차이는 R 커뮤니티에서 다소 학술적인데
이유는 대부분 사용자가 팩키지를 갱신하는 방식이 
`update.packages()`를 실행해서 진행하기 때문이다. 이런 경우, 설사 대번호 버젼이 변경되어 잠재적으로 코드를 깨뜨릴 수 있음에도 불구하고, 팩키지 가장 최신 버젼으로 갱신한다.
더 많은 R 사용자가 프로젝트 기반으로 팩키지 버젼을 관리하는 [packrat](http://rstudio.github.io/packrat/)같은 도구에 친숙해지는 동안에, 버젼번호를 가지고 무엇을 하든지 상관없이,
매우 큰 이전 버젼과 호환되지 않는 변경을 할 때 주의를 기울일 필요가 있다. 


이전 버젼과 호환성의 중요성은 팩키지를 사용하는 사용자 숫자와 직접적으로 비례한다: 개발자의 시간과 팩키지 사용자 시간을 거래하는 것이다. 이전 버젼과 호환성을 더 강하게 유지하려고 하면 할수록,
신규 기능을 개발하거나 오래된 실수를 고치는 것은 더 어려워진다.
이전 버젼과 호환되는 코드는 또한 가독성도 더 떨어진다. 왜냐하면 이전 버젼으로부터 나온 기능을 지원하는데 필요한 다수 경로를 유지보수해야 되기 때문이다. 이전 버젼과 호환성에 관심을 가져야 되지만,
개발자 본인을 마비시킬 정도까지 가지는 마라.

이전 버젼과 비호환되는 변경을 할 좋은 사유도 있다 -
만약 팩키지를 사용하기 어렵게 만드는 아키텍쳐 설계 오류를 저질렀다면, 늦게라도 빨리 버그를 고치는 것이 더 낫다.
만약 이전 버젼과 비호환되는 변경을 취할 필요가 있다면,
점진적으로 작업을 실행하는 것이 최선이다.
지금 현재 위치와 향후 가려고 하는 위치 사이에 중간 버젼을 제공하고
어떤 변경이 있을지에 관한 안내도 제공하라.
무엇을 변경할지에 따라 다르겠지만,
다음 기법 중 하나를 사용해서 팩키지 사용자가 무슨 일이 일어나고 있는지 알 수 있게 정보를 제공하라:


  * 함수를 즉각 제거하지 않는다. 먼저 함수를 사라지게 만들어라(deprecate). 예를 들어, 현재 버젼이 `0.5.0` 이고,
  `fun()` 함수를 제거하고 싶다고 가정하자.
  버젼 `0.6.0` 에서, `.Deprecated()`를 사용해서 누군가 함수를 사용할 때마다 경고 메시지를 출력하게 한다:
  
    ```{r}
    # 0.1.0
    fun <- function(x, y, z) {
      .Deprecated("sum")
      x + y + z
    }
    
    fun(1, 2, 3)
    ```
    
    그리고 나서, `0.7.0` 버젼으로 올리게 되면 함수를 제거한다 
    (혹은 만약 본인이 엄격한 편이라면, `1.0.0` 버젼으로 올리게 될 때 실행한다. 왜냐하면 이전 버젼과 호환되지 않는 변경사항이기 때문이다).
    

  * 비슷하게, 만약 함수 인자를 제거한다면, 먼저 경고를 띄운다:
  
    ```{r}
    bar <- function(x, y, z) {
      if (!missing(y)) {
        warning("argument y is deprecated; please use z instead.", 
          call. = FALSE)
        z <- y
      }
    }
    
    bar(1, 2, 3)
    ```

  * 만약 사라지게할 코드가 엄청 많다면,
    도움말 함수를 추가하는 것이 도움이 될 수 있다.
    예를 들어, `ggplot2` 는 `gg_dep`를 갖고 있어서 
    버젼 번호가 얼마나 변경되었는지에 따라 자동으로 메시지,
    경고 혹은 오류를 화면에 출력한다.
  

    ```{r}
    gg_dep <- function(version, msg) {
      v <- as.package_version(version)
      cv <- packageVersion("ggplot2")
    
      # If current major number is greater than last-good major number, or if
      # current minor number is more than 1 greater than last-good minor number,
      # return an error.
      if (cv[[1,1]] > v[[1,1]]  ||  cv[[1,2]] > v[[1,2]] + 1) {
        stop(msg, " (Defunct; last used in version ", version, ")",
          call. = FALSE)
    
      # If minor number differs by one, give a warning
      } else if (cv[[1,2]] > v[[1,2]]) {
        warning(msg, " (Deprecated; last used in version ", version, ")",
          call. = FALSE)
    
      # If only subminor number is greater, provide a message
      } else if (cv[[1,3]] > v[[1,3]]) {
        message(msg, " (Deprecated; last used in version ", version, ")")
      }
    
      invisible()
    }
    ```

  * 기존 함수에 상당한 변화는 다수 버젼에 걸쳐 점진적인 변경을 포함한 계획이 요구된다. 
  변경 각각에 대해 정보가 되는 오류 메시지를 동반하는 일련의 변경을 시도하고 개발해 보라.
  
  
  * 만약 또다른 팩키지 신규 버젼의 기능을 사용한다면,
  `DESCRIPTION` 파일에 경직된 설치시점 의존성은 만들지 마라.
  (사용자가 팩키지를 갱신하게 강제해서 다른 코드를 망가뜨릴 수 있다).
  대신에 실행시간 버젼에 대한 검사를 한다:
    
    ```{r, eval = FALSE}
    if (packageVersion("ggplot2") < "1.0.0") {
      stop("ggplot2 >= 1.0.0 needed for this function.", call. = FALSE)
    }
    ```
    
    만약 팩키지 의존성 중 하나에 변경사항에 대응한다면 이렇게 하는 것도 유용할 수 있다 - 변경 전과 후에 모두 동작하는 버젼을 갖출 수 있다. 심지어 다른 팩키지 이전에도, CRAN에 아무때고 팩키지를 제출할 수 있게끔 한다. 이렇게 작업하면 일부 `R CMD check` 유의사항을 생성할 수도 있다. 예를 들어:
    
    ```{r, eval = FALSE}
    if (packageVersion("foo" > "1.0.0")) {
      foo::baz()
    } else {
      foo::bar()
    }
    ```
    
    만약 `baz` 함수가 foo 버젼 1.0.0 에 존재하지 않는다면,
    foo 네임스페이스에 해당 함수가 존재하지 않는다는 유의사항이 발생된다. 
    CRAN에 제출할 때 버젼사이 차이나는 사항에 대해 작업하고 있다고만 설명한다.
    
## 제출 프로세스 {#release-check}

수작업으로 작성한 팩키지를 CRAN에 제출하기 위해서,
팩키지 번들을 생성하고 나서 <http://cran.r-project.org/submit.html> 웹사이트에 지켰던 프로세스를 기술하는 주석과 함께 업로드한다.
이번절에서 표준 구조를 제공함으로써 가능하면 쉽게 제출하는 방법을 공개한다. 추후에 [submission](#release-submission)에서 
`devtools::release()`를 사용해서 실제 팩키지를 제출하는 방법을 볼 것이다.

CRAN에 제출할 때, CRAN이 자원봉사자로 구성되어 있다는 것을 기억하라.
구성원 모두 다른 정규 직업을 가지고 있다. 전형적인 한주는 100개가 넘는 팩키지 제출건수가 있고 단지 자원봉사자 3명만이 이들 모두를 처리한다.
자원봉사자를 위해서 더 적은 일을 던진다면, 좀더 즐거운 팩키지 제출을 경험할 듯 하다.  

`cran-comments.md`로 불리는 파일에 제출 주석(comment)을 저장하는 것을 저자는 추천한다. `cran-comments.md` 파일은 Git에 등록되어야만 하고 (그래서 시간에 따라 추적할 수 있다), `.Rbuildignore` 목록에 올라가야 된다 (그래서 팩키지에는 포함되지 않게 된다).
`R 확장 작성`에서 추천하듯이, 마크다운 사용을 저자도 추천한다. 왜냐하면, 일반 텍스트를 보기 좋게 배치하는 표준 방식을 제공하기 때문이다. 하지만, 내용물이 또다른 형식으로 절대 렌더링되지 않기 때문에, 너무 특정 형식에 구속된다는 걱정을 할 필요는 없다.
`httr` 최신 버젼으로부터 나온 `cran-comments.md` 파일이 다음에 나와 있다:

```md
## Test environments
* local OS X install, R 3.1.2
* ubuntu 12.04 (on travis-ci), R 3.1.2
* win-builder (devel and release)

## R CMD check results
There were no ERRORs or WARNINGs. 

There was 1 NOTE:

* checking dependencies in R code ... NOTE
  Namespace in Imports field not imported from: 'R6'

  R6 is a build-time dependency.

## Downstream dependencies
I have also run R CMD check on downstream dependencies of httr 
(https://github.com/wch/checkresults/blob/master/httr/r-release). 
All packages that I could install passed except:

* Ecoengine: this appears to be a failure related to config on 
  that machine. I couldn't reproduce it locally, and it doesn't 
  seem to be related to changes in httr (the same problem exists 
  with httr 0.4).
```

This layout is designed to be easy to skim, and easy to match up to the `R CMD check` results seen by CRAN maintainers. It includes three sections:

1.  Test environments: this describes where I checked the package. I always 
    check on three platforms: my mac, [travis-ci](#travis) and win-builder. 
   
1.  Check results: I always state that there were no errors or warnings. 
    Any `NOTE`s go in a bulleted list. For each `NOTE`, I include the message 
    from `R CMD check` and a brief description of why I think it's OK.
    If there were no `NOTE`s, I'd say "There were no ERRORs, WARNINGs or NOTEs"

1.  Downstream dependencies: If there are downstream dependencies, I run 
    `R CMD check` on each package and summarise the results. If there are
    no downstream dependencies, keep this section, but say: "There are currently
    no downstream dependencies for this package".

These are described in more detail below.

### Test environments {#release-test-env}

When checking your package you need to make sure that it passed with the current development version of R and it works on at least two platforms. `R CMD check` is continuously evolving, so it's a good idea to check your package with the latest development version, __R-devel__. You can install R-devel on your own machine:

* Mac: install from <http://r.research.att.com>.

* Windows: install from <http://cran.r-project.org/bin/windows/base/rdevel.html>

* Linux: either build it from source, or better, learn about Docker containers
  and run the R-devel container from <https://github.com/rocker-org/rocker>.

It's painful to manage multiple R versions, especially since you'll need to reinstall all your packages. Instead, you can run `R CMD check` on CRAN's servers with `devtools::build_win()`.  This builds your package and submits it to the CRAN win-builder. 10-20 minutes after submission, you'll receive an e-mail telling you the check results.

CRAN runs on multiple platforms: Windows, Mac OS X, Linux and Solaris. You don't need to run `R CMD check` on every one of these platforms, but it's a really good idea to do it on at least two. This increases your chances of spotting code that relies on the idiosyncrasies of specific platform. If you're on linux or the mac, use `devtools::build_win()` to check on windows. If you're on windows, use Travis, as described in [continuous integration with Travis](#travis), to run checks on linux.

Debugging code that works on your computer but fails elsewhere is painful. If that happens to you, either install a virtualisation tool so that you can run another operating system locally, or find a friend to help you figure out the problem. Don't submit the package and hope CRAN will help you figure out the problem.

### Check results {#release-check}

You've already learned how to use `R CMD check` and why it's important in [automated checking](#check). Compared to running `R CMD check` locally, there are a few important differences when running it for a CRAN submission:

  * You must fix all `ERROR`s and `WARNING`s. A package that contains any errors 
    or warnings will not be accepted by CRAN.
  
  * Eliminate as many `NOTE`s as possible. Each `NOTE` requires human oversight, 
    which is a precious commodity. If there are notes that you do 
    not believe are important, it is almost always easier to fix them (even if 
    the fix is a bit of a hack) than to persuade CRAN that they're OK. See 
    [check descriptions](#check-checks) for details on how to fix individual 
    problems.
    
    If you have no `NOTE`s it is less likely that your package will be 
    flagged for additional human checks. These are time consuming for both
    you and CRAN, so are best avoided if possible. 
  
  * If you can't eliminate a `NOTE`, document it in `cran-comments.md`, 
    describing why you think it is spurious. Your comments should be easy to 
    scan, and easy to match up with `R CMD check`. Provide the CRAN maintainers 
    with everything they need in one place, even if it means repeating yourself.
    
    NB: There will always be one `NOTE` when you first submit your package. 
    This reminds CRAN that this is a new submission and that they'll need to 
    do some extra checks. You can't eliminate this, so just mention in
    `cran-comments.md` that this is your first submission.

### Reverse dependencies {#release-deps}

Finally, if you're releasing a new version of an existing package, it's your responsibility to check that downstream dependencies (i.e. all packages that list your package in the `Depends`, `Imports`, `Suggests` or `LinkingTo` fields) continue to work. To help you do this, devtools provides `devtools::revdep_check()`. This:

1. Sets up a temporary library so it doesn't clobber any existing packages you
   have installed.
   
1. Installs all of the dependencies of the downstream dependencies.

1. Runs `R CMD check` on each package.

1. Summarises the results in a single file.

Run `use_revdep()` to set up your package with a useful template.

If any packages fail `R CMD check`, you should give package authors at least two weeks to fix the problem before you submit your package to CRAN (you can easily get all maintainer e-mail addresses with `revdep_maintainers()`). After the two weeks is up, re-run the checks, and list any remaining failures in `cran-comments.md`. Each package should be accompanied by a brief explanation that either tells CRAN that it's a false positive in `R CMD check` (e.g. you couldn't install a dependency locally) or that it's a legitimate change in the API (which the maintainer hasn't fixed yet). 

Inform CRAN of your release process: "I advised all downstream packages maintainers of these problems two weeks ago". Here's an example from a recent release of dplyr:

```
Important reverse dependency check notes (full details at 
https://github.com/wch/checkresults/tree/master/dplyr/r-release);

* COPASutils, freqweights, qdap, simPH: fail for various reasons. All package 
  authors were informed of the upcoming release and shown R CMD check issues 
  over two weeks ago.

* ggvis: You'll be receiving a submission that fixes these issues very shortly
  from Winston.

* repra, rPref: uses a deprecated function.
```

## CRAN policies {#cran-policies}

As well as the automated checks provided by `R CMD check`, there are a number of [CRAN policies](http://cran.r-project.org/web/packages/policies.html) that must be checked manually. The CRAN maintainers will typically look at this very closely on a package's first submission.

I've summarised the most common problems below:

* It's vital that the maintainer's e-mail address is stable because this is the 
  only way that CRAN has to contact you, and if there are problems and they 
  can't get in touch with you they will remove your package from CRAN. So make 
  sure it's something that's likely to be around for a while, and that it's not 
  heavily filtered.

* You must have clearly identified the copyright holders in `DESCRIPTION`:
  if you have included external source code, you must ensure that the license
  is compatible. See [license](#license) and [`src/` licensing](#src-licensing)
  for more details.

* You must "make all reasonable efforts" to get your package working across
  multiple platforms. Packages that don't work on at least two will
  not normally be considered.

* Do not make external changes without explicit user permission. Don't write to 
  the file system, change options, install packages, quit R, send information 
  over the internet, open external software, etc.
  
* Do not submit updates too frequently. The policy suggests a new version
  once every 1-2 months at most.

I recommend following the [CRAN Policy Watch](https://twitter.com/CRANPolicyWatch) Twitter account which tweets whenever there's a policy change. You can also look at the GitHub repository that powers it: <https://github.com/eddelbuettel/crp/commits/master/texi>.

## Important files {#important-files}

You now have a package that's ready to submit to CRAN. But before you do, there are two important files that you should update: `README.md` which describes what the package does, and `NEWS.md` which describes what's changed since the previous version. I recommend using Markdown for these files, because it's useful for them to be readable as both plain text (e.g. in emails) and HTML (e.g. on GitHub, in blog posts). I recommend using Github flavoured Markdown, <https://help.github.com/articles/GitHub-flavored-Markdown/>, for these files.

### README.md {#readme}

The goal of the `README.md` is to answer the following questions about your package:

* Why should I use it?
* How do I use it?
* How do I get it?

On GitHub, the `README.md` will be rendered as HTML and displayed on the repository home page. 

I normally structure my `README` as follows:

1.  A paragraph that describes the high-level purpose of the package.

1.  An example that shows how to use the package to solve a simple problem.

1.  Installation instructions, giving code that can be copied and pasted into R.

1.  An overview that describes the main components of the package. For more
    complex packages, this will point to vignettes for more details.

### README.Rmd {#readme-rmd}

If you include an example in your `README` (a good idea!) you may want to generate it with R Markdown. The easiest way to get started is to use `devtools::use_readme_rmd()`. This creates a template `README.Rmd` and adds it to `.Rbuildignore`. The template looks like:
    
```
---
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```
```

This:

* Outputs Github flavoured Markdown.

* Includes a comment in `README.md` to remind you to edit `README.Rmd`, not
  `README.md`.

* Sets up my recommended knitr options, including saving an image to 
  `README-chunkname.png` (which is automatically `.Rbuildignore`d.)

You'll need to remember to re-knit `README.Rmd` each time you modify it. If you use git, `use_readme_rmd()` automatically adds the following "pre-commit" hook:

```bash
#!/bin/bash
if [[ README.Rmd -nt README.md ]]; then
  echo "README.md is out of date; please re-knit README.Rmd"
  exit 1
fi 
```

This prevents `git commit` from succeeding unless `README.md` is more recent than `README.Rmd`. If you get a false positive, you can ignore the check with `git commit --no-verify`.  Note that git commit hooks are not stored in the repository, so every time you clone the repo, you'll need to run `devtools::use_readme_rmd()` to set it up again.

### NEWS.md {#news}

The `README.md` is aimed at new users. The `NEWS.md` is aimed at existing users: it should list all the API changes in each release. There are a number of formats you can use for package news, but I recommend `NEWS.md`. It's not supported by CRAN (so you'll need to run `devtools::use_build_ignore("NEWS.md")`), but it's well supported by GitHub and is easy to re-purpose for other formats.

Organise your `NEWS.md` as follows:

* Use a top-level heading for each version: e.g. `# mypackage 1.0`. The most
  recent version should go at the top.

* Each change should be included in a bulleted list. If you have a lot of 
  changes you might want to break them up using subheadings, `## Major changes`,
  `## Bug fixes` etc. I usually stick with a simple list until just before
  releasing the package when I'll reorganise into sections, if needed.
  It's hard to know in advance exactly what sections you'll need.

* If an item is related to an issue in GitHub, include the issue number in
  parentheses, e.g. `(#10)`. If an item is related to a pull request, include 
  the pull request number and the author, e.g. `(#101, @hadley)`. Doing
  this makes it easy to navigate to the relevant issues on GitHub.

The main challenge with `NEWS.md` is getting into the habit of noting a change as you make a change. 

## Release {#release-submission}

You're now ready to submit your package to CRAN. The easiest way to do this is to run `devtools::release()`. This:

* Builds the package and runs `R CMD check` one last time.

* Asks you a number of yes/no questions to verify that you followed the
  most common best practices.
  
* Allows you to add your own questions to the check process by including an
  unexported `release_questions()` function in your package. This should
  return a character vector of questions to ask. For example, httr has:
  
    ```{r}
    release_questions <- function() {
      c(
        "Have you run all the OAuth demos?",
        "Is inst/cacert.pem up to date?"
      )
    }
    ```
    
    This is useful for reminding you to do any manual tasks that 
    can't otherwise be automated.
  
* Uploads the package bundle to the 
  [CRAN submission form](http://cran.r-project.org/submit.html) including the
  comments in `cran-comments.md`.

Within the next few minutes, you'll receive an email notifying you of the submission and asking you to approve it (this confirms that the maintainer address is correct). Next the CRAN maintainers will run their checks and get back to you with the results. This normally takes around 24 hours, but occasionally can take up to 5 days.

### On failure

If your package does not pass `R CMD check` or is in violation of CRAN policies, a CRAN maintainer will e-mail you and describe the problem(s). Failures are frustrating, and the feedback may be curt and may feel downright insulting. Arguing with CRAN maintainers will likely waste both your time and theirs. Instead:

* Breathe. A rejected CRAN package is not the end of the world. It happens to
  everyone. Even members of R-core have to go through the same process and CRAN 
  is no friendlier to them. I have had numerous packages rejected by CRAN.
  I was banned from submitting to CRAN for two weeks because too many of 
  my existing packages had minor problems.

* If the response gets you really riled up, take a couple of days to cool down
  before responding. Ignore any ad hominem attacks, and strive to respond only 
  to technical issues.

* If a devtools problem causes a CRAN maintainer to be annoyed with you, I 
  am deeply sorry. If you forward me the message along with your address,
  I'll send you a hand-written apology card.

Unless you feel extremely strongly that discussion is merited, don't respond to the e-mail. Instead:

  * Fix the identified problems and make recommended changes. Re-run
    `devtools::check()` to make sure you didn't accidentally introduce any 
    new problems.
  
  * Add a "Resubmission" section at the top of `cran-comments.md`. This should 
    clearly identify that the package is a resubmission, and list the changes 
    that you made.
    
    ```md
    ## Resubmission
    This is a resubmission. In this version I have:
    
    * Converted the DESCRIPTION title to title case.
    
    * More clearly identified the copyright holders in the DESCRIPTION
      and LICENSE files.
    ```
  
  * If necessary, update the check results and downstream dependencies sections.
  
  * Run `devtools::submit_cran()` to re-submit the package without working 
    through all the `release()` questions a second time.

### Binary builds

After the package has been accepted by CRAN it will be built for each platform. It's possible this may uncover further errors. Wait 48 hours until all the checks for all packages have been run, then go to the check results package for your package:

```{r, echo = FALSE}
bookdown::embed_png("screenshots/cran-checks.png", dpi = 220)
```

Prepare a patch release that fixes the problems and submit using the same process as above.

## Prepare for next version {#post-release}

Once your package has been accepted by CRAN, you have a couple of technical tasks to do:

* If you use GitHub, go to the repository release page. Create a new release
  with tag version `v1.2.3` (i.e. "v" followed by the version of your package).
  Copy and paste the contents of the relevant `NEWS.md` section into the release 
  notes.
  
* If you use git, but not GitHub, tag the release with `git tag -a v1.2.3`.

* Add the `.9000` suffix to the `Version` field in the DESCRIPTION to indicate
  that this is a development version. Create a new heading in `NEWS.md` and commit the changes.

## Publicising your package {#promotion}

Now you're ready for the fun part: publicising your package. This is really important. No one will use your helpful new package if they don't know that it exists.

Start by writing a release announcement. This should be an R Markdown document that briefly describes what the package does (so people who haven't used it before can understand why they should care), and what's new in this version. Start with the contents of `NEWS.md`, but you'll need to modify it. The goal of `NEWS.md` is to be comprehensive; the goal of the release announcement is to highlight the most important changes. Include a link at the end of the announcement to the full release notes so people can see all the changes. Where possible, I recommend showing examples of new features: it's much easier to understand the benefit of a new feature if you can see it in action. 

There are a number of places you can include the announcement:

* If you have a blog, publish it there. I now publish all package release
  announcements on the [RStudio blog](http://blog.rstudio.org/author/hadleywickham/).

* If you use Twitter, tweet about it with the #rstats hashtag.

* Send it to the 
  [r-packages mailing list](https://stat.ethz.ch/mailman/listinfo/r-packages).
  Messages sent to this list are automatically forwarded to the R-help mailing 
  list.

# Congratulations!

You have released your first package to CRAN and made it to the end of the book! 
